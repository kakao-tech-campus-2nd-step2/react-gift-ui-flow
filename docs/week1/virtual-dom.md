# 가상 DOM

## 가상 DOM

### 기존의 문제점

- SPA의 특징으로 잦은 레이아웃/리페인팅 발생 → 브라우저의 DOM 관리 부담
  - 한 페이지에서 계속해서 요소의 위치를 재계산
  - 라우팅 시엔 대부분의 요소를 삭제, 삽입, 계산

### 가상 DOM이란

- 리액트(react-dom)가 관리하는 가상의 DOM
- 웹 페이지가 표시할 DOM을 메모리에 저장
- 변경 준비가 완료되었을 때 실제 브라우저 DOM에 반영
- DOM 계산을 브라우저가 아닌 메모리에서 계산

## 리액트 파이버

- 리액트에서 사용하는 자바스크립트 객체
- 가상 DOM과 실제 DOM을 비교해 변경 사항을 수집
  - 파이버를 기준으로 화면에 렌더링을 요청

### 파이버

- 작업을 작은 단위로 분할해 우선 순위 매기기
- 작업을 일시 중지하고 나중에 다시 시작
- 이전에 했던 작업을 재사용하거나 폐기 가능

#### 특징

- 비동기적으로 발생
  - 우선 순위가 높은 작업을 빠르게 처리하는 스케줄링 가능
- 컴포넌트가 최초로 마운트될 때 생성 후 재사용
  - 기존 객체의 내부 속성값만 초기화하거나 바꾸어 값을 업데이트

### 파이버 트리

- current 트리와 workInProgress 트리 2개 존재
  - current 트리: 현재 모습을 담은 파이버 트리
  - workInProgress 트리: 작업 중인 상태를 나타내는 파이버 트리
- 리액트 파이버의 작업이 끝나면 포인터를 변경해 worInProgress 트리를 current 트리로 바꿈
  - 더블 버퍼링

## 리액트의 UI 업데이트 과정

- 메모리 상에서 파이버의 작동 방식으로 가상 DOM을 생성
- 최종 결과물을 실제 브라우저의 DOM에 적용

1. 가상 DOM 생성
   - 컴포넌트가 렌더링될 때 가상 DOM 생성
2. 파이버 구조로 변경 사항 계산
   - UI 업데이트 시 파이버 트리의 더블 버퍼링으로 가상 DOM 변경
3. 실제 DOM 업데이트
   - 변경된 부분만 실제 브라우저의 DOM에 적용
