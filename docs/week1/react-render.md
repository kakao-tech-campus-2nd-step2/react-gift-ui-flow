# 리액트의 렌더링

## 리액트의 렌더링

### 정의

- 리액트 애플리케이션 트리 안에 있는 모든 컴포넌트들이 구성한 DOM 결과를 브라우저에 제공하는 과정

  - 컴포넌트는 자신의 props와 state 값을 기반으로 UI를 구성
  - 구성된 UI를 기반으로 가상 DOM 트리를 생성
  - 리액트는 가상 DOM을 비교해 변경된 부분만 실제 DOM에 반영

- 컴포넌트가 props와 state와 같은 상태 값을 가지고 있지 않다면..
  - 해당 컴포넌트가 반환하는 JSX값으로만 렌더링 발생

### 렌더링 트리거

1. 최초 렌더링
   - 사용자가 처음 애플리케이션에 진입했을 때 발생
2. 리렌더링
   - 최초 렌더링 이후 발생하는 모든 렌더링

### 리렌더링 종류

- 컴포넌트의 state 변화
  - 리렌더링 트리거
    - 클래스 컴포넌트의 `setState` 실행
    - 함수 컴포넌트의 `useState()`의 setter 실행
    - `useReducer()`의 dispatch 실행
  - state 변화의 발생 이유
    - 사용자의 입력, 네트워크 응답, 시간 경과 등 이벤트
- 컴포넌트의 props의 변화
  - 리렌더링 트리거
    - 부모로부터 전달받는 값인 props가 변경
  - props가 변경된 자식 컴포넌트가 리렌더링
- 부모 컴포넌트의 렌더링
  - 리렌더링 트리거
    - 부모 컴포넌트의 리렌더링 발생
  - 모든 자식 컴포넌트가 다시 리렌더링
- 강제 업데이트
  - 리렌더링 트리거
    - 클래스 컴포넌트의 `forceUpdate` 실행

#### 컴포넌트의 key props 변경 시 컴포넌트의 재생성

- key 값이 변경되면 해당 컴포넌트는 제거되고 새로운 컴포넌트가 생성됨
- 이전 컴포넌트를 언마운트하고 새로운 컴포넌트를 마운트함
- state와 DOM 노드의 초기화 발생

→ 리스트의 인덱스를 key 값으로 사용하는 것을 지양하자

#### 상태관리 라이브러리의 리렌더링

- 기본적인 리액트의 렌더링 과정 X
- 각자의 방식으로 state 변화를 감지하고 렌더링 유발
- 필요한 경우에만 컴포넌트 리렌더링 → 성능 최적화

## 리액트 렌더링 과정

1. 트리거
2. 렌더
3. 커밋

### 렌더

: 컴포넌트를 렌더링하고 변경 사항을 개선하는 작업

- 컴포넌트를 호출 해 변경이 필요한 컴포넌트 체크
  - 비교 대상: type, props, key
  - 비교 대상이 하나라도 변경 시 변경이 필요한 컴포넌트로 인식
  - 비교 과정은 리액트의 가상 DOM 동작 원리와 관련
- 렌더링 작업은 부모가 변경되었다면 무조건 자식 컴포넌트도 리렌더링
  - 자식 컴포넌트의 props나 state 변경 유무와 무관

#### 초기 렌더

- render() 메서드의 루트 컴포넌트 호출
- 가상 DOM과 실제 DOM이 동기화

#### 리렌더

- 상태업데이트가 발생한 컴포넌트 호출
- 재조정: 가상 DOM 트리와 새로운 가상 DOM 트리 비교
  - 실제 DOM에 변경할 내용 파악

### 커밋

- 두 가상 DOM 사이의 변화 내용을 실제 DOM에 적용
- DOM 노드를 새로 생성, 수정, 삭제 해 DOM 트리를 동기화
- 커밋 단계가 끝나야 브라우저의 렌더링 발생

#### 리액트의 렌더링이 일어난다고 무조건 DOM 업데이트가 발생하지 않음

- 렌더링을 수행했으나 변경 사항이 없다면 커밋 단계가 생략됨
- 부모 컴포넌트의 변경으로 자식 컴포넌트가 리렌더링 될 때, memo를 사용 해 렌더링 생략 가능 → 렌더링 성능 개선
